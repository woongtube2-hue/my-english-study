<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>English Study - Individual Play</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; background: #f8f9fa; }
        .controls { margin-bottom: 20px; display: flex; gap: 10px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; position: relative; }
        
        /* ì œëª© ìŠ¤íƒ€ì¼ */
        .day-title { color: #2c3e50; font-size: 1.8rem; margin-bottom: 20px; border-bottom: 3px solid #3498db; display: inline-block; }
        
        /* ë¬¸ì œë³„ ì„¹ì…˜ */
        .question-block { margin-bottom: 30px; padding: 15px; border-left: 5px solid #eee; }
        .q-text { font-weight: bold; color: #2980b9; font-size: 1.1rem; margin-bottom: 10px; }
        .s-text { background: #fdfdfd; padding: 10px; border-radius: 5px; white-space: pre-wrap; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button { cursor: pointer; border: none; border-radius: 5px; transition: 0.2s; }
        .btn-play { background: #3498db; color: white; padding: 5px 10px; font-size: 0.8rem; margin-bottom: 5px; }
        .blur { filter: blur(5px); }
        .blur:hover { filter: blur(0); }
    </style>
</head>
<body>

    <div id="header-area">
        <h1 id="main-title">ë¡œë”© ì¤‘...</h1>
        <div class="controls">
            <select id="day-select" onchange="loadScript(this.value)"></select>
            <button onclick="toggleAllBlur()" style="background:#6c757d; color:white; padding:8px;">ğŸ™ˆ ì „ì²´ ì•”ê¸°ëª¨ë“œ</button>
        </div>
    </div>

    <div id="container"></div>

    <script>
        let sections = []; // íŒŒì‹±ëœ ë°ì´í„°ë¥¼ ë‹´ì„ ë°°ì—´

        async function loadScript(day) {
            try {
                const response = await fetch(`./script/day${day}.txt`);
                const text = await response.text();
                parseAndRender(text);
            } catch (e) { document.getElementById('container').innerText = "íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."; }
        }

        function parseAndRender(rawText) {
            const container = document.getElementById('container');
            const lines = rawText.split('\n');
            
            // 1. ì²« ì¤„ ì œëª© ì²˜ë¦¬
            document.getElementById('main-title').innerText = lines[0].replace(/ğŸŒ³/g, '').trim();
            
            container.innerHTML = "";
            sections = [];
            let currentSection = null;

            // 2. ë‚´ìš© íŒŒì‹± ë¡œì§
            lines.slice(1).forEach(line => {
                if (line.startsWith('Q')) {
                    if (currentSection) sections.push(currentSection);
                    currentSection = { title: line, question: "", script: "" };
                } else if (line.startsWith('Question:')) {
                    currentSection.question = line.replace('Question:', '').trim();
                } else if (line.startsWith('Script:')) {
                    currentSection.script = line.replace('Script:', '').trim() + "\n";
                } else if (currentSection && line.trim() !== "") {
                    // Q1 ë‹¤ìŒ Q2ê°€ ë‚˜ì˜¤ê¸° ì „ê¹Œì§€ ëª¨ë“  ë‚´ìš©ì„ Scriptì— ì¶”ê°€
                    currentSection.script += line.trim() + "\n";
                }
            });
            if (currentSection) sections.push(currentSection);

            // 3. HTML ìƒì„±
            sections.forEach((sec, index) => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <div class="q-text">${sec.title}</div>
                    <p><strong>Q:</strong> ${sec.question}</p>
                    <button class="btn-play" onclick="speakSection(${index})">â–¶ ì´ ë¬¸ì œ ë‹µë³€ ë“£ê¸°</button>
                    <div class="s-text highlight-script">${sec.script}</div>
                `;
                container.appendChild(div);
            });
        }

        // íŠ¹ì • ì„¹ì…˜ë§Œ ì½ì–´ì£¼ëŠ” TTS
        function speakSection(index) {
            window.speechSynthesis.cancel(); // ê¸°ì¡´ ì¬ìƒ ì¤‘ë‹¨
            const text = sections[index].script;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }

        function toggleAllBlur() {
            document.querySelectorAll('.highlight-script').forEach(el => el.classList.toggle('blur'));
        }

        window.onload = () => loadScript(1);
    </script>
</body>
</html>