<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>English Practice Room</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; background: #f4f7f6; color: #333; }
        .day-header { text-align: center; margin-bottom: 30px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .day-header h1 { color: #2c3e50; margin: 0 0 15px 0; font-size: 1.8rem; }
        .controls { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; border-left: 6px solid #3498db; position: relative; }
        .q-title { color: #e67e22; font-weight: bold; font-size: 1.1rem; margin-bottom: 8px; }
        .q-question { color: #7f8c8d; font-style: italic; margin-bottom: 15px; background: #f9f9f9; padding: 12px; border-radius: 8px; border: 1px inset #eee; }
        .s-box { background: #fff; border: 1px solid #edf2f7; padding: 18px; border-radius: 10px; white-space: pre-wrap; margin-top: 10px; font-size: 1.05rem; line-height: 1.8; }
        .audio-controls { margin-bottom: 15px; }
        button { cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.2s; padding: 10px 18px; }
        .btn-play { background: #3498db; color: white; }
        .btn-play.playing { background: #2ecc71; }
        .btn-stop { background: #e74c3c; color: white; margin-left: 5px; }
        .btn-blur-toggle { background: #95a5a6; color: white; }
        button:hover { opacity: 0.8; transform: translateY(-1px); }
        .blur { filter: blur(5px); transition: 0.3s; }
        .blur:hover { filter: blur(0); }
        select { padding: 10px; border-radius: 8px; border: 1px solid #ddd; outline: none; }
    </style>
</head>
<body>

    <div class="day-header">
        <h1 id="main-title">í•™ìŠµ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</h1>
        <div class="controls">
            <select id="day-select" onchange="loadScript(this.value)">
                <option value="1">Day 1: ê³µì›(Parks)</option>
                <option value="2">Day 2: ìŒì•… ê°ìƒ(Music)</option>
                <option value="3">Day 3: ì§‘(My Home) í…Œë§ˆ ìµœì¢… ìŠ¤í¬ë¦½íŠ¸ ì •ë¦¬</option>
            </select>
            <button class="btn-stop" onclick="stopAudio()">ğŸ›‘ ì „ì²´ ì¤‘ì§€</button>
            <button class="btn-blur-toggle" onclick="toggleBlur()">ğŸ™ˆ ì•”ê¸°ëª¨ë“œ ON/OFF</button>
        </div>
    </div>

    <div id="container"></div>

    <script>
        let currentSections = [];

        async function loadScript(day) {
            try {
                stopAudio();
                const response = await fetch(`./script/day${day}.txt`);
                const text = await response.text();
                parseContent(text);
            } catch (e) { document.getElementById('container').innerText = "íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."; }
        }

        function parseContent(rawText) {
            const lines = rawText.split('\n');
            document.getElementById('main-title').innerText = lines[0].replace(/ğŸŒ³/g, '').trim();

            const container = document.getElementById('container');
            container.innerHTML = "";
            currentSections = [];
            let temp = null;

            lines.slice(1).forEach(line => {
                const trimmed = line.trim();
                if (!trimmed) return;

                if (line.match(/^Q\d+/)) {
                    if (temp) currentSections.push(temp);
                    temp = { title: trimmed, question: "", script: "" };
                } else if (line.startsWith('Question:')) {
                    temp.question = line.replace('Question:', '').trim();
                } else if (line.startsWith('Script:')) {
                    temp.script = line.replace('Script:', '').trim() + "\n";
                } else if (temp) {
                    temp.script += trimmed + "\n";
                }
            });
            if (temp) currentSections.push(temp);
            render();
        }

        function render() {
            const container = document.getElementById('container');
            currentSections.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="q-title">${item.title}</div>
                    <div class="q-question"><strong>Q:</strong> ${item.question}</div>
                    <div class="audio-controls">
                        <button id="p-btn-${index}" class="btn-play" onclick="playAudio(${index})">â–¶ ë‹µë³€ ë“£ê¸°</button>
                        <button class="btn-stop" onclick="stopAudio()">â¹ ì¤‘ì§€</button>
                    </div>
                    <div class="s-box highlight-area blur">${item.script}</div>
                `;
                container.appendChild(card);
            });
        }

        function playAudio(index) {
            stopAudio();
            const btn = document.getElementById(`p-btn-${index}`);
            btn.classList.add('playing');
            btn.innerText = "ğŸ”Š ì¬ìƒ ì¤‘...";

            const speech = new SpeechSynthesisUtterance(currentSections[index].script);
            speech.lang = 'en-US';
            speech.rate = 0.85;
            speech.onend = () => {
                btn.classList.remove('playing');
                btn.innerText = "â–¶ ë‹µë³€ ë“£ê¸°";
            };
            window.speechSynthesis.speak(speech);
        }

        function stopAudio() {
            window.speechSynthesis.cancel();
            document.querySelectorAll('.btn-play').forEach(b => {
                b.classList.remove('playing');
                b.innerText = "â–¶ ë‹µë³€ ë“£ê¸°";
            });
        }

        function toggleBlur() {
            document.querySelectorAll('.highlight-area').forEach(el => el.classList.toggle('blur'));
        }

        window.onload = () => loadScript(1);
    </script>
</body>
</html>